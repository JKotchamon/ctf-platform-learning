<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Weird Encodings Chain</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="/static/style.css"/>
  <style>
    /* hint UI */
    details { background:#0f1320; border:1px solid #23283b; border-radius:12px; padding:.9rem 1rem; margin:.7rem 0; }
    details[open] { background:#12172a; }
    details > summary { cursor:pointer; font-weight:600; outline:none; }
    code.inline { padding:.15rem .35rem; background:#1b2136; border-radius:6px; }
    .hash { user-select:all; }

    /* flag form */
    .flag-box { margin-top:1rem; padding:1rem; background:#0f1320; border-radius:12px; border:1px solid #23283b; }
    .flag-box h2 { margin-top:0; }
    .flag-row { display:flex; gap:.75rem; align-items:center; }
    input[type=text] { flex:1; padding:.6rem .75rem; border-radius:8px; border:1px solid #23283b; background:#fff; color:#111; }
    button { padding:.6rem 1rem; border:none; border-radius:8px; background:#3b82f6; color:#fff; font-weight:700; cursor:pointer; }
    #result { margin-top:.7rem; font-weight:700; }
    #result.ok { color:#22c55e; }
    #result.fail { color:#ef4444; }

    .btn { display:inline-block; padding:.6rem 1rem; border-radius:8px; background:#1f6feb; color:#fff; text-decoration:none; font-weight:600; }
    .bullets { margin-top:1rem; }
  </style>
</head>
<body>
  <main>
    <h1>Weird Encodings Chain</h1>

    <!-- Flag Submission Channel FIRST -->
    <div class="flag-box">
      <h2>Submit Your Flag</h2>
      <form id="flagForm" class="flag-row">
        <input type="text" id="flagInput" placeholder="Enter flag here (CTF{...})" required/>
        <button type="submit">Check</button>
      </form>
      <div id="result"></div>
    </div>

    <!-- Challenge meta and hash BELOW the submission box -->
    <ul class="bullets">
      <li><b>File:</b> A text file that looks like gibberish.</li>
      <li><b>Trick:</b> Multiple layers ‚Äî peel carefully.</li>
      <li><b>Difficulty:</b> Hard ‚Äî persistence pays off.</li>
      <li><b>Flag hash (SHA-256):</b> <code class="inline hash">{{ pub_hash }}</code></li>
    </ul>

    <p><a class="btn" href="/download">Download <b>weird.txt</b></a></p>

    <h2 style="margin-top:2rem;">Hints (progressive)</h2>

    <details>
        <summary>Hint 1 (gentle)</summary>
        <p>The text is made entirely of characters 0‚Äì9 and a‚Äìf.  
        That usually means you should think in pairs.</p>
    </details>

    <details>
        <summary>Hint 2 (medium)</summary>
        <p>Once you turn those pairs into symbols, you‚Äôll see a strange language
        of dots, dashes, and slashes. It‚Äôs older than telephones.</p>
    </details>

    <details>
        <summary>Hint 3 (strong)</summary>
        <p>After the beeps become letters, they still read a bit ‚Äútilted.‚Äù
           Give every letter the same small rotation; digits and symbols stay put,
           and the shift wraps around the ends (‚Ä¶Z rolls back to A). Doing the same twist twice cancels it.</p>
    </details>

    <details>
        <summary>Hint 4 (final)</summary>
        <p>Now you‚Äôll hold a message that only uses uppercase letters A‚ÄìZ and the digits 2‚Äì7.
        It‚Äôs a way computers often turn binary into text for easier copying.</p>
    </details>

    <details>
        <summary>Hint 5 (bonus)</summary>
        <p>Every layer builds on the last ‚Äî don‚Äôt skip steps.  
        If your output looks nonsense, retrace and try peeling one layer at a time.</p>
    </details>

    <p class="tiny">If you get stuck, consider whether you‚Äôre decoding in the right order ‚Äî onions don‚Äôt peel from the middle üßÖ.</p>
  </main>

  <script>
    document.getElementById("flagForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const flag = document.getElementById("flagInput").value.trim();
      const res = await fetch("/verify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ flag })
      });
      const data = await res.json();
      const result = document.getElementById("result");
      if (data.correct) {
        result.textContent = "Correct flag!";
        result.className = "ok";
      } else {
        result.textContent = "Wrong flag, try again.";
        result.className = "fail";
      }
    });
  </script>
</body>
</html>
